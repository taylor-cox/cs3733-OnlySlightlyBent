<html>

<head>
    <script type="text/javascript">
        var add_url = "https://q0ec12olg0.execute-api.us-east-1.amazonaws.com/beta/calculator";
        var playlistNum = 1;
        var videoNum = 1;
        var selectedPlaylist = -1;
        var selectedVideo = -1;

        function processResponse(arg1, arg2, result) {
            // Can grab any DIV or SPAN HTML element and can then manipulate its
            // contents dynamically via javascript
            console.log("result:" + result);
            var js = JSON.parse(result);

            var computation = js["result"];

            // Update computation result
            document.addForm.result.value = computation
        }

        function makeList(isPlaylist, num) {
            var listHTML = '';
            var isEven = 1;
            for (var i = 0; i < num; i++) {
                if ((isPlaylist ? selectedPlaylist : selectedVideo) == i) listHTML += '<div class="rowSelected"';
                else if (isEven) listHTML += '<div class="rowEven"';
                else listHTML += '<div class="rowOdd"';
                isEven = !isEven;
                listHTML += 'onClick="JavaScript:select' + (isPlaylist ? 'Playlist' : 'Video') + '(' + i + ')"';
                listHTML += '>\n <span class="columnName" style="width:50%">(';
                listHTML += isPlaylist ? "Playlist" : "Video";
                listHTML += ' ' + (i + 1);
                listHTML += ' name)</span>\n';
                if (!isPlaylist) {
                    listHTML += '<video width=300 height=200 controls>';
                    listHTML += '<source src="https://3733onlyslightlybent.s3.amazonaws.com/video-clips/vlc-record-2019-11-10-13h19m35s-dvd____E__-_Trim.ogg" type="video/ogg">';
                    listHTML += '</video>'
                }
                listHTML += ' <input type="button" value="M" style="width:20%" onClick="JavaScript:handleClick(this)">\n';
                listHTML += ' <button style="width:20%" onClick="JavaScript:handleDelete'
                listHTML += isPlaylist ? "Playlist" : "Video";
                listHTML += '(';
                listHTML += i;
                listHTML += ')">\n';
                listHTML += '   <img src="trash_can.png">\n';
                listHTML += '   <noscript><span>X</span></noscript>\n';
                listHTML += ' </button>\n';
                listHTML += '</div>\n';
            }
            document.getElementById(isPlaylist ? "playlists" : "videos").innerHTML = listHTML;
        }

        function selectPlaylist(p) {
            selectedPlaylist = p;
            makeList(1, playlistNum);
        }

        function selectVideo(v) {
            selectedVideo = v;
            makeList(0, videoNum);
        }

        function handleDeleteVideo(p) {
            videoNum--;
            makeList(0, videoNum);
        }

        function handleNewVideo() {
            videoNum++;
            makeList(0, videoNum);
        }

        function handleDeletePlaylist(p) {
            playlistNum--;
            makeList(1, playlistNum);
        }

        function handleNewPlaylist() {
            playlistNum++;
            makeList(1, playlistNum);
        }

        function handleMyLibraryClick() {
            window.alert("My library has been clicked.")
        }

        function handleSearchClick(e) {
            var form = document.addForm;
            var searchField = form.searchField.value;

            window.alert(searchField);
            processResponse();

            /*  var data = {};
              data["arg1"] = arg1;
              data["arg2"] = arg2;

              var js = JSON.stringify(data);
              console.log("JS:" + js);
              var xhr = new XMLHttpRequest();
              xhr.open("POST", add_url, true);

              // send the collected data as JSON
              xhr.send(js);

              // This will process results and update HTML as appropriate.
              xhr.onloadend = function () {
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE) {
                	if (xhr.status == 200) {
            	      console.log ("XHR:" + xhr.responseText);
            	      processResponse(arg1, arg2, xhr.responseText);
                	} else if (xhr.status == 400) {
                		alert ("unable to process request");
                	}
                } else {
                  processResponse(arg1, arg2, "N/A");
                }
              };*/
        }
    </script>
</head>

<body>
    <form name="addForm" method="post">
        <h1>Video Mashup</h1>
        <link rel="stylesheet" href="index.css">

        <div class="row">
            <div class="column" style="background-color:#aaa">
                <h2>Playlists</h2>
                <div class="rowEven">
                    <input type="button" value="My Library" style="width:100%"
                        onClick="JavaScript:handleMyLibraryClick(this)">
                </div>
                <br>
                <div class="rowOdd">
                    <input type="button" value="New Playlist" style="width:100%"
                        onClick="JavaScript:handleNewPlaylist()">
                </div>
                <br>

                <div id="playlists"></div>

                <br>
            </div>

            <div class="columnPad" style="background-color:#fff"></div>
            <div class="column" style="background-color:#aaa">
                <h2>Videos</h2>
                <div class="rowEven">
                    <input name="searchField" value="" style="width:65%" />

                    <input type="button" value="Search" style="width:30%" onClick="JavaScript:handleSearchClick(this)">
                </div>
                <br>
                <div class="rowOdd">
                    <input type="button" value="Upload Video" style="width:100%" onClick="JavaScript:handleNewVideo()">
                </div>
                <br>

                <div id="videos"></div>

                <br>
            </div>
        </div>
    </form>

    <script>
        makeList(1, playlistNum);
        makeList(0, videoNum);
    </script>

</body>

</html>